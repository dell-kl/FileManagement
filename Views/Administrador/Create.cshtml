@model SIS_DIAF.Models.ModelViews.RolesModelViews

@{
    Layout = "_Layout2";
    ViewData["Title"] = "Asignar Usuario";
}

@section styles {
    <link href="~/css/admin.css" rel="stylesheet" />
}
    
<div class="crearUsuario">
    <h1>Gestionar Roles</h1>

    <div class="tabla">
        <button class="btn btn-success" id="btn-agregarRol" data-bs-toggle="modal" data-bs-target="#agregarRol">
            <i class='bx bxs-user-plus'></i>
            Agregar
        </button>

        <table class="table table-striped table-bordered table-responsive">
            <thead>
                <tr>
                    <th scope="col" style="text-align: center;">Id</th>
                    <th scope="col" style="text-align: center;">Descripción</th>
                    <th scope="col" style="text-align: center;">Estado</th>
                    <th scope="col" style="text-align: center;">Última Modificación</th>
                    <th scope="col" style="text-align: center;">Accion</th>
                </tr>
            </thead>
            <tbody>
                @foreach(var s in Model.Roles){
                    
                    <tr>
                    <th scope="row" style="vertical-align:middle; text-align: center">@s.rol_id</th>
                    <td style="vertical-align:middle; text-align: center"><p>@s.rol_descripcion</p></td>
                    <td style="vertical-align:middle; text-align: center">
                            @if (s.rol_estado.Equals("activo"))
                        {
                            <div class="estado activo">@s.rol_estado</div>
                        }
                        else{
                                <div class="estado desactivado">@s.rol_estado</div>
                        }
                    </td>
                    <td style="vertical-align:middle;">
                        <p class="fecha-modificacion">23/10/2023 21:47:40</p>
                    </td>
                    <td class="editar-usuario" style="vertical-align:middle;">
                        <a href="#" class="btn btn-warning" data-bs-toggle="modal" id="btn-editar-@s.rol_id" data-bs-target="#editar-@s.rol_id">
                            <i class='bx bxs-edit-alt' style="font-size:20px;"></i>
                        </a>
                        <div class="modal fade formEditar" id="editar-@s.rol_id" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header d-flex flex-column">
                                        <h3 class="modal-title fs-5" id="exampleModalLabel">Editar Rol</h3>
                                        <p>Puedes gestionar el estado del rol y su eliminación respectiva</p>
                                    </div>
                                    <form method="POST" asp-controller="Administrador" asp-action="EditRol">
                                        <input type="hidden" name="id" value="@s.rol_id" />
                                        <div class="modal-body">
                                            <div class="campos">
                                                <div class="campo">
                                                    <label for="descripcion">Rol del usuario</label>
                                           
                                                    @Html.TextBox("descripcion", s.rol_descripcion, new
                                                        {
                                                            @class = "form-control",
                                                            @id = "descripcion",
                                                            @placeholder = "Inserta un rol"
                                                        })
                                                        
                                                    @Html.ValidationMessageFor(r => r.RegistroRolDto.descripcion, null, new { @class = "mensaje error_mensaje text-danger" })
                                                   
                                                </div>
                                                <div class="campo">
                                                    <label for="Estado">Estado del usuario</label>
                                                    <select name="estado">

                                                        @if (s.rol_estado.Equals("activo"))
                                                        {   
                                                            <option value="activo" selected>activo</option>
                                                            <option value="inactivo">inactivo</option>
                                                        }
                                                        else
                                                        {
                                                            <option value="activo">activo</option>
                                                            <option value="inactivo" selected>inactivo</option>
                                                        }

                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Cancelar</button>
                                            <button type="submit" class="btn btn-success">Actualizar</button>
                                        </div>

                                    </form>
                                </div>  
                            </div>
                        </div>
                        <a href="~/Administrador/Delete/@s.rol_id" class="btn btn-danger">
                            <i class='bx bxs-trash' style="font-size:20px;"></i>
                        </a>
                    </td>
                    </tr>
                }
            </tbody>
        </table>
        <div class="acciones-paginador">
            <a href="~/Administrador/Create?pagina=0&tipo=continuar" class="btn btn-warning">Inicio</a>
            <a href="~/Administrador/Create?pagina=@ViewData["Relementos"]&tipo=retroceder" class="btn btn-primary"><i class='bx bx-chevron-left'></i><span>Anterior</span></a>
            <a href="~/Administrador/Create?pagina=5&tipo=continuar" class="btn btn-primary"><span>Siguiente</span><i class='bx bx-chevron-right'></i></a>
            <a href="~/Administrador/Create?pagina=@ViewData["Nelementos"]&tipo=final" class="btn btn-warning">Final</a>
        </div>

        <!-- Formulario para poder agregar a otro rol -->
        <div class="modal fade formRegistrar" id="agregarRol" tabindex="-1" aria-labelledby="exampleModalLabel">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header d-flex flex-column">
                        <h3 class="modal-title fs-5 text-success" id="exampleModalLabel">Registrar Rol</h3>
                        <p class="">Registra un nuevo rol para asignarselo a tus usuarios</p>
                    </div>  
                    @using (Html.BeginForm("CreateRol", "Administrador", FormMethod.Post))
                    {
                        <div class="modal-body">
                            <div class="campos">
                                <div class="campo">
                                    <label for="descripcion">Rol del usuario</label>
                                    <input type="text" asp-for="RegistroRolDto.descripcion" id="descripcion" class="form-control" placeholder="Inserta un rol"/>
                                    <span class="text-danger" asp-validation-for="RegistroRolDto.descripcion"></span>
                                </div>
                                <div class="campo">
                                    <select id="estado" name="estado" asp-for="RegistroRolDto.estado">
                                        <option disabled selected value="">-- Estado del usuario --</option>
                                        <option value="activo">activo</option>
                                        <option value="inactivo">inactivo</option>
                                    </select>
                                    <span class="text-danger" asp-validation-for="RegistroRolDto.estado"></span>
                                </div>
                            </div>
                        </div>  
                        <div class="modal-footer">
                            <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Cancelar</button>
                            <button type="submit" class="btn btn-success">Registrar</button>
                        </div>
                    }
                </div>
            </div>
        </div>

    </div>
</div>

@section Scripts {

    @{
        if (this.TempData.ContainsKey("status") && this.TempData["status"] != null)
        {
            var resultado = this.TempData["status"];

            if ( resultado.Equals("registrar") )
            {
                <script>
                    document.getElementById("btn-agregarRol").click();
                </script>
            }
            else if (resultado.Equals("error editar") || resultado.Equals("error registrar"))
            {
                <script>
                    swal({
                        title: "Registro o Edicion Rol",
                        text: "El proceso de registro o edicion no se logro completar, posiblemente el rol ya este registrado.",
                        icon: "error",
                        button: "Cerrar"
                    });
                </script>
            }
            else if (resultado.Equals("completado editar") || resultado.Equals("completado registrar"))
            {
                <script>
                    swal({
                        title: "Registro o Edicion Rol",
                        text: "El proceso de registro o edicion se completo correctamente",
                        icon: "success",
                        button: "Cerrar"
                    });
                </script>
            }
            else
            {
                <script>
                    document.getElementById(`btn-editar-${@resultado}`).click();
                </script>
            }

            this.TempData.Remove("status");
        }


    }
}
